<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Sparrow by GateprotectGmbH</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Sparrow</h1>
        <p>Define your request and response JSON format with a Rack middleware! </p>

        <p class="view"><a href="https://github.com/GateprotectGmbH/sparrow">View the Project on GitHub <small>GateprotectGmbH/sparrow</small></a></p>


        <ul>
          <li><a href="https://github.com/GateprotectGmbH/sparrow/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/GateprotectGmbH/sparrow/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/GateprotectGmbH/sparrow">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="sparrow" class="anchor" href="#sparrow" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sparrow</h1>

<p>A Rack middleware for converting the params keys and JSON response keys of a Rack application.</p>

<p><a href="https://travis-ci.org/GateprotectGmbH/sparrow"><img src="https://travis-ci.org/GateprotectGmbH/sparrow.svg?branch=master" alt="Build Status"></a> <a href="http://badge.fury.io/rb/cp-sparrow"><img src="https://badge.fury.io/rb/cp-sparrow.svg" alt="Gem Version"></a></p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Add this line to your application's Gemfile:</p>

<pre><code>gem 'cp-sparrow', require: 'sparrow'
</code></pre>

<p>And then execute:</p>

<pre><code>$ bundle
</code></pre>

<p>Or install it yourself as:</p>

<pre><code>$ gem install cp-sparrow
</code></pre>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>If you're using Rails, that's it. You haven't to do anything more. If you're not using Rails, you will have to add to your config.ru:</p>

<div class="highlight highlight-rb"><pre><span class="pl-k">require</span> <span class="pl-s"><span class="pl-pds">'</span>sparrow<span class="pl-pds">'</span></span>

use <span class="pl-c1">Sparrow</span>::<span class="pl-c1">Middleware</span></pre></div>

<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>There are various configuration options as well as HTTP headers available to
make the middleware act as you want it to.</p>

<p>in your configuration file (such as application.rb if you are using Rails)</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c1">Sparrow</span>.configure <span class="pl-k">do </span>|<span class="pl-smi">config</span>|
  config.excluded_routes <span class="pl-k">=</span> [
    <span class="pl-c1">Regexp</span>.<span class="pl-k">new</span>(<span class="pl-s"><span class="pl-pds">'</span>api/model/certificates<span class="pl-pds">'</span></span>)
  ]
<span class="pl-k">end</span></pre></div>

<p>Options may be:</p>

<h3>
<a id="excluded_routes" class="anchor" href="#excluded_routes" aria-hidden="true"><span class="octicon octicon-link"></span></a>excluded_routes</h3>

<blockquote>
<p>Array(String|Regexp)</p>
</blockquote>

<p>An Array of Strings and/or Regexps defining which paths should not be touched by the middleware. The entries should matchs paths for your application. They should <em>not</em> start with a leading slash.</p>

<p>Example:</p>

<blockquote>
<p><code>config.excluded_routes = ['api/model/certificates']</code></p>
</blockquote>

<h3>
<a id="default_json_request_key_transformation_strategy" class="anchor" href="#default_json_request_key_transformation_strategy" aria-hidden="true"><span class="octicon octicon-link"></span></a>default_json_request_key_transformation_strategy</h3>

<blockquote>
<p>String</p>
</blockquote>

<p>Defines how the middleware should treat incoming parameters via Request. Which means how they get tranformed, i.e. defining <em>underscore</em> here means that incoming parameters get underscore. Possible values are <em>underscore</em> and <em>camelize</em></p>

<p>Example:</p>

<blockquote>
<p><code>config.default_json_request_key_transformation_strategy = "underscore"</code></p>
</blockquote>

<h3>
<a id="default_json_response_key_transformation_strategy" class="anchor" href="#default_json_response_key_transformation_strategy" aria-hidden="true"><span class="octicon octicon-link"></span></a>default_json_response_key_transformation_strategy</h3>

<blockquote>
<p>String</p>
</blockquote>

<p>Same as <strong>default_json_request_key_transformation_strategy</strong>, but for responses. I.e. this defines to which format the keys get transformed when the response gets sent.</p>

<p>Example:</p>

<blockquote>
<p><code>config.default_json_response_key_transformation_strategy = "camelize"</code></p>
</blockquote>

<h3>
<a id="json_request_format_header" class="anchor" href="#json_request_format_header" aria-hidden="true"><span class="octicon octicon-link"></span></a>json_request_format_header</h3>

<blockquote>
<p>String</p>
</blockquote>

<p>Defines the HTTP Header key which sets the request transformation strategy as in default_json_request_key_transformation_strategy*. This definition has higher priority than the default definition. Any valid HTTP Header String value is possible. Defaults to <code>request-json-format</code>.</p>

<p>Example:</p>

<blockquote>
<p><code>config.json_request_format_header = "request-json-format"</code></p>
</blockquote>

<h3>
<a id="json_response_format_header" class="anchor" href="#json_response_format_header" aria-hidden="true"><span class="octicon octicon-link"></span></a>json_response_format_header</h3>

<blockquote>
<p>String</p>
</blockquote>

<p>Same as <strong>json_request_format_header</strong>, but for the response handling. Defaults to <code>response-json-format</code></p>

<p>Example:</p>

<blockquote>
<p><code>config.json_response_format_header = "response-json-format"</code></p>
</blockquote>

<h3>
<a id="camelize_ignore_uppercase_keys" class="anchor" href="#camelize_ignore_uppercase_keys" aria-hidden="true"><span class="octicon octicon-link"></span></a>camelize_ignore_uppercase_keys</h3>

<blockquote>
<p>Boolean</p>
</blockquote>

<p>A boolean that indicates to not camelize keys that are all Uppercase, like CountryCodes "EN", etc.</p>

<p>Example:</p>

<blockquote>
<p><code>config.camelize_ignore_uppercase_keys = true</code></p>
</blockquote>

<h3>
<a id="allowed_content_types" class="anchor" href="#allowed_content_types" aria-hidden="true"><span class="octicon octicon-link"></span></a>allowed_content_types</h3>

<blockquote>
<p>Array(String)</p>
</blockquote>

<p>A list of HTTP content types upon which the middleware shall trigger and possibly start  conversion. Defaults to <code>['application/json', 'application/x-www-form-urlencoded', 'text/x-json']</code>. If <code>nil</code> is present in the list, requests/responses with <em>no</em> Content-Type header will be processed as well. Possible values can also be the start of the content-type-header like <code>application/</code> which matches everything that starts with <code>application/</code> like <code>application/json</code></p>

<p>Example:</p>

<blockquote>
<p><code>config.allowed_content_types = ['application/json', 'text/x-json']</code></p>
</blockquote>

<h3>
<a id="allowed_accepts" class="anchor" href="#allowed_accepts" aria-hidden="true"><span class="octicon octicon-link"></span></a>allowed_accepts</h3>

<blockquote>
<p>Array(String)</p>
</blockquote>

<p>Same as [allowed_content_types], but reacts to the HTTP Accept Header. Applies to the same possible options, behavior. Defaults to the same set of MIME types, but also includes <code>nil</code> by default, which ignores checking the Accept header in default configuration</p>

<p>Example:</p>

<blockquote>
<p><code>config.allowed_accepts = ['application/json', 'text/x-json']</code></p>
</blockquote>

<h3>
<a id="enable_logging" class="anchor" href="#enable_logging" aria-hidden="true"><span class="octicon octicon-link"></span></a>enable_logging</h3>

<blockquote>
<p>Boolean</p>
</blockquote>

<p>Determines logging while the middleware is active. Primary output is which conversion strategy gets chosen upon which request/response.</p>

<p>Example:</p>

<blockquote>
<p><code>config.enable_logging = true</code></p>
</blockquote>

<h2>
<a id="tests" class="anchor" href="#tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tests</h2>

<p>Just run <code>rake</code> and you are off to go. This runs the whole suite including
specs for unit- &amp; integrationtests for Rails and Rack including different versions of Rails.</p>

<p>If you want to test a specific version of Rails:</p>

<pre><code>export RAILS_VERSION=3.2.17; bundle update; bundle exec rspec
</code></pre>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/GateprotectGmbH">GateprotectGmbH</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
